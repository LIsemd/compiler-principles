!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);const s=t=>t.filter((t,e,n)=>n.indexOf(t)===e),i=t=>/^[A-Z]$/.test(t),r=t=>t.split(" ").join(""),o=(t,e=new WeakMap)=>{if("object"!=typeof t)return t;if(e.has(t))return e.get(t);let n=t instanceof Array?[]:{};for(let s in t)t.hasOwnProperty(s)&&(n[s]=o(t[s],e));return e.set(t,n),n},l=t=>{for(let e=0;e<t.length;e++)(t.charCodeAt(e)<32||127===t.charCodeAt(e))&&(t=t.replace(t[e],""));return t},a=(...t)=>{t.forEach(t=>{(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)})(t)})};var c=class{constructor(t=!1,e=!1){this.isStart=t,this.isEnd=e,this.transition={},this.epsilonTransition=[]}addTransition(t,e){return this.transition[t]?this.transition[t]=this.transition[t].concat(e):this.transition[t]=e,this}addEpsilonTransition(t){return this.epsilonTransition.push(t),this}setId(t){return this.id=t,this}visit(){return this.isVisited=!0,this}setCoreState(t){return this.coreState=t,this}setOldStateId(t){return this.oldStateIdArray=t,this}};const h="·",d="|",f="*",u="(",m=")",p="ε",g="#",b="→",y={[d]:1,[h]:2,[f]:3};class E{constructor(t,e){this.startNode=t,this.endNode=e}static createBasicNFA(t){const e=new c(!0,!1),n=new c(!1,!0);return t?e.addTransition(t,[n]):e.addEpsilonTransition(n),new E(e,n)}static union(t,e){const n=new c(!0,!1),s=new c(!1,!0);return n.addEpsilonTransition(t.startNode).addEpsilonTransition(e.startNode),t.startNode.isStart=!1,t.endNode.addEpsilonTransition(s).isEnd=!1,e.startNode.isStart=!1,e.endNode.addEpsilonTransition(s).isEnd=!1,new E(n,s)}static closure(t){const e=new c(!0,!1),n=new c(!1,!0);return e.addEpsilonTransition(t.startNode).addEpsilonTransition(n),t.endNode.addEpsilonTransition(t.startNode).addEpsilonTransition(n).isEnd=!1,t.startNode.isStart=!1,new E(e,n)}static getCurrentId(t){const e=t.length;return e?t[e-1].id+1:0}static dfsforNFA(t,e){if(t.isVisited)return;const n=E.getCurrentId(e);if(e.push(t.setId(n).visit()),!t.isEnd){if(Object.keys(t.transition).length)for(let n in t.transition){const s=t.transition[n][0];E.dfsforNFA(s,e)}if(t.epsilonTransition.length)for(let n of t.epsilonTransition)E.dfsforNFA(n,e)}}static connect(t,e){const n=t.startNode,s=e.endNode;return t.endNode.addEpsilonTransition(e.startNode).isEnd=!1,e.startNode.isStart=!1,new E(n,s)}static buildNFA(t){const e=[];for(let n=0;n<t.length;n++){let s=t[n];if(s===u||s===m)throw new Error("输入的表达式有误");if(s===d)try{const t=e.pop(),n=e.pop();e.push(E.union(n,t))}catch(t){throw new Error("输入的表达式有误")}else if(s===f)try{const t=e.pop();e.push(E.closure(t))}catch(t){throw new Error("输入的表达式有误")}else if(s===h)try{const t=e.pop(),n=e.pop();e.push(E.connect(n,t))}catch(t){throw new Error("输入的表达式有误")}else s===p?e.push(E.createBasicNFA(void 0)):e.push(E.createBasicNFA(s))}if(e.length>1)throw new Error("输入的表达式有误");return e.pop()}static buildNFAStack(t){const e=[];return E.dfsforNFA(t.startNode,e),e}static initNFAStack(t){return t.forEach(t=>{t.isVisited=!1}),this}}var S=E;var F=class{constructor(t=!1,e=!1){this.isStart=t,this.isEnd=e,this.transition={},this.epsilonTransition=[]}addTransition(t,e){return this.transition[t]?this.transition[t]=this.transition[t].concat(e):this.transition[t]=e,this}addEpsilonTransition(t){return this.epsilonTransition.push(t),this}setId(t){return this.id=t,this}visit(){return this.isVisited=!0,this}setCoreState(t){return this.coreState=t,this}setOldStateId(t){return this.oldStateIdArray=t,this}};class x{static dfsForEpsilon(t,e){t.epsilonTransition.length&&!t.isVisited&&(t.visit(),t.epsilonTransition.forEach(t=>{e.push(t),x.dfsForEpsilon(t,e)}))}static getEpsilonClosure(t){const e=[t];return x.dfsForEpsilon(t,e),e}static createNewNode(t,e){let n=[],i=[];const r=new F(!1,t.some(t=>t.isEnd));return t.forEach(t=>{i.push(t.id),Object.keys(t.transition).length&&(n=n.concat(t.transition))}),i=s(i),i.sort((t,e)=>t-e),r.setOldStateId(i).setCoreState(e),n.forEach(t=>{let e=Object.keys(t)[0];r.addTransition(e,t[e])}),r}static unionClosureNode(t,e,n){let s=[];S.initNFAStack(n);for(let e of t)s=s.concat(x.getEpsilonClosure(e));return x.createNewNode(s,e)}static NFAToDFA(t,e,n,i){if(!e[t.coreState.toString()]){e[t.coreState.toString()]=!0;for(let r in t.transition){let o=[],l=[];if(t.transition[r].forEach(t=>{o.push(t.id),l.push(i[t.id])}),o=s(o),e[o.toString()])continue;const a=x.unionClosureNode(l,o,i);n.push(a),x.NFAToDFA(a,e,n,i)}}}static renameState(t,e=!1){const n={};for(let s=0;s<t.length;s++)if(t[s].id=s,e)t[s].coreState.forEach(t=>{n[t.toString()]=s});else{const e=t[s].coreState.sort((t,e)=>t-e);n[e.toString()]=s}t.forEach(t=>{for(let i in t.transition){const r=t.transition[i];if(e){let e=parseInt(r.toString());t.transition[i]=n[e]}else{let e=[];r.forEach(t=>{e.push(t.id)}),e=s(e).sort((t,e)=>t-e),t.transition[i]=n[e.toString()]}}})}static splitStateIdArrays(t,e,n){if(1===t.length)return;let s=[],i=[],r=[],o=[],l=[],a=[],c=[],h=!1;t.forEach(t=>{s.push({id:t.id,to:t.transition})});for(let t=0;t<s.length-1;t++)for(let n=t+1;n<s.length;n++){let r=s[t],o=s[n],l=Object.keys(r.to).length,a=0;for(let t in r.to)r.to[t]===o.to[t]?a++:e.forEach(e=>{-1!==e.indexOf(Number(r.to[t]))&&-1!==e.indexOf(Number(o.to[t]))&&a++});a===l?(-1===i.indexOf(r.id)&&i.push(r.id),-1===i.indexOf(o.id)&&i.push(o.id)):h=!0}h?(t.forEach(t=>{-1!==i.indexOf(t.id)?(r.push(t),o.push(t.id)):(l.push(t),a.push(t.id))}),e.forEach((t,e,n)=>{-1!==t.indexOf(o[0])&&(n[e]=o,n.push(a))}),c.push(r),c.push(l)):c=t,n++,c.forEach(t=>{n<=t.length&&x.splitStateIdArrays(t,e,n)})}static splitStateList(t,e){const n=[];return e.forEach(e=>{let s=!1,i=!1,r={};e.forEach(e=>{!s&&t[e].isStart&&(s=!0),!i&&t[e].isEnd&&(i=!0),Object.keys(r).length||(r=t[e].transition)});const o=new F(s,i);o.transition=r,o.setOldStateId(e),o.setCoreState(e),n.push(o)}),x.renameState(n,!0),x.removeExtraAttributes(n),n}static removeExtraAttributes(t){t.forEach(t=>{delete t.coreState,delete t.epsilonTransition})}static buildDFA(t){const e=[];let n=[t[0]],s=[n[0].id];const i=x.unionClosureNode(n,s,t);return i.isStart=!0,e.push(i),x.NFAToDFA(i,{},e,t),x.renameState(e),e}static simplify(t){let e=[],n=[],s=[],i=[],r=[],o=[];return t.forEach(t=>{t.isEnd?(s.push(t),r.push(t.id)):(i.push(t),o.push(t.id))}),s.length&&(e.push(s),n.push(r)),i.length&&(e.push(i),n.push(o)),e.forEach(t=>{x.splitStateIdArrays(t,n,0)}),x.splitStateList(t,n)}}var L=x;class T{static translate(t){return this.infixToPostfix(this.insertSeparator(t))}}T.peek=t=>t.length&&t[t.length-1],T.getPriority=(t,e)=>y[t]&&y[t]>=y[e],T.insertSeparator=t=>{let e="";for(let n=0;n<t.length;n++){const s=t[n];if(e+=s,s!==u&&s!==d&&n<t.length-1){const s=t[n+1];if(s===f||s===m||s===d)continue;e+=h}}return e},T.infixToPostfix=t=>{let e="";const n=[];for(let s=0;s<t.length;s++){let i=t[s];if(i===m){for(;T.peek(n)&&T.peek(n)!==u;)e+=n.pop();n.pop()}else if(i===h||i===d||i===f){for(;T.peek(n)&&T.getPriority(T.peek(n),i);)e+=n.pop();n.push(i)}else i===u?n.push(i):e+=i}for(;n.length;)e+=n.pop();return e};var w=T;var A=class{constructor(t){this.grammar=t}setExtentionGrammar(t){return this.extentionGrammar=t,this}getExtentionGrammar(){return this.extentionGrammar}setLivePrefixDFA(t){return this.livePrefixDFA=t,this}getLivePrefixDFA(){return this.livePrefixDFA}setWithoutLeftRecursionSymbols(t){return this.withoutLeftRecursionSymbols=t,this}getWithoutLeftRecursionSymbols(){return this.withoutLeftRecursionSymbols}setWithoutLeftFactorSymbols(t){return this.withoutLeftFactorSymbols=t,this}getWithoutLeftFactorSymbols(){return this.withoutLeftFactorSymbols}setTerminalSymbols(t){return this.terminalSymbols=t,this}getTerminalSymbols(){return this.terminalSymbols}setUnterminalSymbols(t){return this.unterminalSymbols=t,this}getUnterminalSymbols(){return this.unterminalSymbols}setFirstAndFollow(t){return this.firstAndFollow=t,this}getFirstAndFollow(){return this.firstAndFollow}setAnalysisTable(t){return this.analysisTable=t,this}getAnalysisTable(){return this.analysisTable}setIsMatchLL_1(t){this.isMatchLL_1=t}getIsMatchLL_1(){return this.isMatchLL_1}getResult(){return this.result}initStack(){const t=[],e=this.analysisTable[0].base;return t.push("#"),t.push(e),t}findByAnalysisTable(t,e){for(let n of this.analysisTable)if(n.base===e&&n.to[t])return n.to[t];return null}testByLL1(t){let e=!1;t[t.length-1]!==g&&(t+=g);const n=[],s=this.initStack(),r={stack:s.join(" "),input:null,string:t,output:"初态"};n.push(r);for(let r=0;r<t.length;r++){const o=t[r],l=t.slice(r+1),a={stack:s.join(" "),input:o,string:l,output:null};let c=s.pop();if("'"===c)do{c=s.pop()+c}while("'"!==c[0]);if(i(c[0])){const t=this.findByAnalysisTable(o,c),n=[];if(t)if(t===p)a.output=c+" "+b+" "+t,r--;else{for(let e=t.length-1;e>=0;e--){let s=t[e];for(;"'"===t[e];)e--,s=t[e]+s;n.push(s)}s.push(...n),a.output=c+" "+b+" "+t,r--}else a.output="Error: 字符不匹配",e=!0}else c===o?c===g&&r===t.length-1?a.output="合法":a.output=`成功匹配 ${c} `:(a.output="Error： 字符不匹配",e=!0);if(n.push(a),e)break}return this.result=n,!0}test(t,e){"LL1"===e&&(this.isMatchLL_1=this.testByLL1(t))}};var I=class{static replaceArrow(t){if(!t.includes(b))throw new Error("文法书写有误, 缺少 → 符号");return t.replace(b,d)}static isTerminalSymbol(t){return!i(t)}static formatGrammar(t){const e=[];for(let n=0;n<t.length;n++){let s=r(t[n]);s=this.replaceArrow(s),e[n]=s.split("|")}return e}static collectSymbols(t){const e=new Set,n=new Set;return t.forEach(t=>{for(let s of t)for(let t=0;t<s.length;t++){let i=s[t];if(this.isTerminalSymbol(s[t]))e.add(i);else{for(;"'"===s[t+1];)i+=s[t+1],t++;n.add(i)}}}),[[...e],[...n]]}static comparePriority(t,e,n){let s,i;return n.forEach(n=>{n.value===t?s=n.key:n.value===e&&(i=n.key)}),s>i}static exposeImplicitLeftRecursion(t){const e=[];for(let n=0;n<t.length;n++)e.push({key:n,value:t[n][0],to:t[n].slice(1)});for(let n=0;n<t.length;n++)for(let s=1;s<t[n].length;s++){const i=t[n][s][0];!this.isTerminalSymbol(i)&&this.comparePriority(t[n][0],i,e)&&e.forEach(e=>{if(e.value===i&&e.to.some(t=>!this.isTerminalSymbol(t[0]))){const i=[];e.to.forEach(e=>{e===p?i.push(t[n][s].slice(1)):i.push(e+t[n][s].slice(1))}),t[n].splice(s,1,...i)}})}}static replaceUnterminalSymbol(t){for(let e=0;e<t.length;e++){const n=t[e][0],s=[],i=[],r=[],o=n+"'";let l=!1;for(let r=1;r<t[e].length;r++){let o=t[e][r][0],a=1;for(;"'"===t[e][r][a];)o+="'";this.isTerminalSymbol(o)||o!==n?i.push(t[e][r]):(s.push(t[e][r]),l=!0)}if(l){t[e].splice(1,t[e].length-1,...i);for(let n=1;n<t[e].length;n++)t[e][n]===p?t[e][n]=o:t[e][n]+=o;s.length&&(r.push(o),s.forEach(t=>{r.push(t.slice(1)+o)}),r.push(p),t.push(r))}}}static getReachableSymbol(t){const e=new Set,n=new Set;e.add(t[0][0]);for(let s=0;s<t.length;s++){const i=t[s][0];if(e.has(i))for(let i=1;i<t[s].length;i++){const r=t[s][i];if(r.includes("'"))for(let t=0;t<r.length-1;t++)if(this.isTerminalSymbol(r[t]))e.add(r[t]);else{let i=r[t];for(;"'"===r[t+1];)i+="'",t++;e.add(i),n.has(i)&&(s=1,n.delete(i))}else for(let t of r)this.isTerminalSymbol(t)||(e.add(t),n.has(t)&&(s=1,n.delete(t)))}else n.add(i)}return[...e]}static eliminateUnreachableSymbol(t){const e=this.getReachableSymbol(t);t.filter(t=>-1!==e.indexOf(t[0]))}static eliminateLeftRecursion(t){const e=o(t);return this.exposeImplicitLeftRecursion(e),this.replaceUnterminalSymbol(e),this.eliminateUnreachableSymbol(e),e}static extractCommonPre(t){const e=new Map;let n="";for(let n=1;n<t.length;n++)for(let s=1;s<=t[n].length;s++){for(;"'"===t[n][s];)s++;let i=t[n].slice(0,s);if(e.has(i)){const t=e.get(i)+1;e.set(i,t)}else e.set(i,1)}return e.forEach((t,e)=>{t>1&&e.length>n.length&&(n=e)}),n}static isAliasExist(t,e){let n=!1;return e.forEach(e=>{e[0]===t&&(n=!0)}),n}static extractLeftFactor(t){const e=o(t);for(let t=0;t<e.length;t++){let n=this.extractCommonPre(e[t]);for(;n.length>0;){let s=e[t][0]+"'";for(;this.isAliasExist(s,e);)s+="'";const i=[s];let r=[];for(let s=e[t].length-1;s>0;s--)e[t][s].startsWith(n)&&r.push({index:s,rest:e[t][s].replace(n,"")});r.forEach(n=>{e[t].splice(n.index,1),i.push(n.rest?n.rest:p)}),e[t].push(n+s),e.push(i),n=this.extractCommonPre(e[t])}}return e}static initFirstAndFollow(t){const e=[];return t.forEach((t,n)=>{const s={base:t[0],first:[],follow:[]};0===n&&s.follow.push(g);for(let e=1;e<t.length;e++){let n=0,i=t[e][n];for(;"'"===t[e][n+1];)i+="'",n++;s.first.includes(i)||s.first.push(i)}e.push(s)}),e}static getUnterminalSymbolFirst(t,e){if(this.isTerminalSymbol(t[0]))return[t];let n=[];return e.forEach(e=>{t===e.base&&(n=e.first)}),n}static combineFirst(t,e){return t=t.concat(e).filter((t,e,n)=>n.indexOf(t)===e)}static getUnterminalSymbolFollow(t,e,n){const s=[];let i=[];return e.forEach(e=>{for(let r=1;r<e.length;r++)if(e[r]!==p)for(let o=0;o<e[r].length;o++){let l=e[r][o];if(!this.isTerminalSymbol(l)){for(;"'"===e[r][o+1];)l+="'",o++;if(t===l)if(o<e[r].length-1){let l=e[r][++o];if(this.isTerminalSymbol(l))i.includes(l)||i.push(l);else{for(;"'"===e[r][o+1];)l+="'",o++;if(o===e.length-1){const n={base:t,target:e[0],tail:l};s.push(n)}i=this.getUnterminalSymbolFirst(l,n).filter(t=>t!==p)}}else{let n=l.length,i=o>0?e[r][o-n]:"",a=i;for(;"'"===i;)a=e[r][o-n]+a,i=o>0?e[r][o-n]:"",n++;const c=s.some(n=>n.base===t&&n.target===e[0]);let h;h=a&&!this.isTerminalSymbol(a[0])?{base:t,target:e[0],pre:a}:{base:t,target:e[0]},c||s.push(h)}}}else s.push({base:p,target:e[0]})}),[i,s]}static getFollowByFirstAndFollow(t,e,n){let s,i=[];if(t.base===p){for(let e of n)if(e.base===t.target&&e.pre&&e.target!==t.target){s=e.target,t.base=e.pre;break}}else if(t.tail){this.getUnterminalSymbolFirst(t.tail,e).includes(p)&&(s=t.target)}else s=t.target;return e.forEach(t=>{s&&s===t.base&&(i=t.follow)}),i}static isAllUnterminals(t){for(let e=0;e<t.length;e++)if(this.isTerminalSymbol(t[e])&&"'"!==t[e])return!1;return!0}static updateFirstByEpsilon(t,e){for(let n=0;n<t.length;n++){const s=t[n].base,i=t[n].first;if(i.includes(p)){let r=!1;e.forEach(o=>{if(o[0]===s){for(let t=1,e=0;t<o.length;t++){let n=o[t][e];for(;"'"===o[t][e+1];)n+="'",e++;if(n===p||this.isAllUnterminals(o[t])){r=!0;break}}r?this.deepUpdateFirst(s,e,t):t[n].first=i.filter(t=>t!==p)}})}}}static deepUpdateFirst(t,e,n,s){let i;e.forEach(r=>{for(let o=1;o<r.length;o++)if(r[o].startsWith(t)&&r[o].length>t.length&&"'"!==r[o][t.length])if(s||(s=r[0]),i=r[o].replace(t,""),this.isTerminalSymbol(i[0]))n.forEach(t=>{t.base!==s||t.first.includes(i[0])||t.first.push(i[0])});else{let t=i[0],r=0;for(;"'"===i[r+1];)t+="'",r++;const o=this.getUnterminalSymbolFirst(t,n);n.forEach(t=>{t.base===s&&(t.first=this.combineFirst(t.first,o))}),o.includes(p)&&this.deepUpdateFirst(t,e,n,s)}})}static createFirstAndFollow(t){const e=this.initFirstAndFollow(t),n=[],s=[];for(let n=0;n<e.length;n++){const s=e[n];for(let t=0;t<s.first.length;t++){const n=s.first[t];if(!this.isTerminalSymbol(n[0])){const i=this.getUnterminalSymbolFirst(n,e);s.first.splice(t,1),s.first=this.combineFirst(s.first,i),t=-1}}this.updateFirstByEpsilon(e,t)}for(let n=0;n<e.length;n++){const i=e[n];for(let t=0;t<i.first.length;t++){const n=i.first[t];if(!this.isTerminalSymbol(n[0])){const s=this.getUnterminalSymbolFirst(n,e);i.first.splice(t,1),i.first=this.combineFirst(i.first,s)}}const[r,o]=this.getUnterminalSymbolFollow(i.base,t,e);i.follow=i.follow.concat(r),o.length&&s.push(...o)}s.forEach(t=>{const e=t.base,s=t.target;n.some(t=>t.base===e&&t.target===s)||n.push(t)});for(let t=0;t<n.length;t++){const s=this.getFollowByFirstAndFollow(n[t],e,n);if(!s.length)continue;let i=!1;e.forEach(e=>{if(e.base===n[t].base){const t=[...new Set(e.follow.concat(s))];e.follow.length<t.length&&(i=!0,e.follow=t)}}),i&&(t=-1)}return e}static initAnalysisTable(t,e,n){for(let s=0;s<t.length;s++){const i={base:t[s],to:[]};for(let t=0;t<e.length;t++)i.to[e[t]]=null;n.push(i)}}static getSymbolByFirst(t,e,n){const s=[];for(let i=1;i<e[n].length;i++){if(e[n][i].startsWith(t))return e[n][i];this.isTerminalSymbol(e[n][i][0])||s.push(e[n][i])}return 1===s.length?s[0]:(s.forEach(n=>{e.forEach((s,i)=>{if(s[0]===n)return this.getSymbolByFirst(t,e,i)})}),"NotFound")}static createAnalysisTable(t,e,n,s){let i=!0;const r=[],o=e.filter(t=>t!==p);return-1===o.indexOf(g)&&o.push(g),this.initAnalysisTable(t,o,r),n.forEach((t,e)=>{const n=[];t.first.forEach(o=>{if(o===p)t.follow.forEach(e=>{n.push(e),r.forEach(n=>{t.base===n.base&&(n.to[e]?n.to[e]=n.to[e]+" / "+p:n.to[e]=p)})});else{n.push(o);let l=this.getSymbolByFirst(o,s,e);"NotFound"===l&&(i=!1),r.forEach(e=>{t.base===e.base&&(e.to[o]?e.to[o]=e.to[o]+" / "+l:e.to[o]=l)})}}),n.some((t,e,n)=>n.indexOf(t)!==e)&&(i=!1)}),[r,i]}static analysisByLL1(t){const e=this.formatGrammar(t),n=this.eliminateLeftRecursion(e),s=this.extractLeftFactor(n),[i,r]=this.collectSymbols(s),o=this.createFirstAndFollow(s),[l,a]=this.createAnalysisTable(r,i,o,s),c=new A(t);return c.setWithoutLeftRecursionSymbols(n),c.setWithoutLeftFactorSymbols(s),c.setTerminalSymbols(i),c.setUnterminalSymbols(r),c.setFirstAndFollow(o),c.setAnalysisTable(l),c.setIsMatchLL_1(a),c}static initExtentionGrammar(t){const e=this.formatGrammar(t);if(!e)return;const n=e[0][0];return e.unshift([n+"'",n]),this.insertDot(e)}static isPendingItem(t){let e=t.indexOf(".")+1;return!!(e<t.length&&i(t[e]))}static isMoveIntoItem(t){let e=t.indexOf(".")+1;return e<t.length&&!i(t[e])}static isReductionItemOrAcceptItem(t){return t.indexOf(".")+1===t.length}static getNextCharByDot(t){return t.includes(".")&&t.indexOf(".")+1<t.length&&t[t.indexOf(".")+1]}static getGrammarByPendingItem(t,e){const n=[];return t.forEach(t=>{if(t[0]===e)for(let e=1;e<t.length;e++)n.push(t[0]+b+t[e])}),n}static initLivePrefixDFA(t,e,n){let i={id:n,dfa:e,next:[]};for(let e=0;e<i.dfa.length;e++){let n=i.dfa[e];if(this.isPendingItem(n)){let e=this.getNextCharByDot(n),r=this.getGrammarByPendingItem(t,e);i.dfa=s(i.dfa.concat(r))}}return this.getLivePrefixDFANext(i),i}static getLivePrefixDFANext(t){t.dfa.forEach(e=>{if(!this.isReductionItemOrAcceptItem(e)){let n=this.getNextCharByDot(e),s={nextChar:n,toId:void 0};t.next.every(t=>t.nextChar!==n)&&t.next.push(s)}})}static isExistCoreDFA(t,e){let n=!1;return t.forEach(t=>{e.every(e=>t.dfa.includes(e))&&(n=!0)}),n}static formatToId(t,e){t.forEach(t=>{t.next.forEach(n=>{e.forEach(e=>{e.fromId.includes(t.id)&&n.nextChar===e.preChar&&(n.toId=e.id)})})})}static createLivePrefixDFA(t){let e=0,n=[],s=[this.initLivePrefixDFA(t,[t[0].join(b)],e++)];for(let i=0;i<s.length;i++){let r=s[i];r.next.forEach(i=>{let o,l=[];if(r.dfa.forEach(t=>{if(this.getNextCharByDot(t)===i.nextChar&&!this.isReductionItemOrAcceptItem(t)){let e=t.replace("."+i.nextChar,i.nextChar+".");l.push(e)}}),this.isExistCoreDFA(n,l)){for(let t of n)if(l.every(e=>t.dfa.includes(e))){t.fromId.push(r.id);break}}else{let i=l[0].indexOf(".")-1,a=i>=0?l[0][i]:null;n.push({dfa:l,id:e,fromId:[r.id],preChar:a}),o=this.initLivePrefixDFA(t,l,e++),this.getLivePrefixDFANext(o),s.push(o)}})}return this.formatToId(s,n),s}static insertDot(t){return t.forEach(t=>{for(let e=1;e<t.length;e++)t[e]===p?t[e]=".":t[e]="."+t[e]}),t}static createFirstAndFollowBySLR1(t){const e=this.formatGrammar(t),n=this.eliminateLeftRecursion(e),s=this.initFirstAndFollow(n),i=[],r=[];for(let t=0;t<s.length;t++){const n=s[t];for(let t=0;t<n.first.length;t++){const e=n.first[t];if(!this.isTerminalSymbol(e[0])){const i=this.getUnterminalSymbolFirst(e,s);n.first.splice(t,1),n.first=this.combineFirst(n.first,i),t=-1}}this.updateFirstByEpsilon(s,e)}for(let t=0;t<s.length;t++){const n=s[t];for(let t=0;t<n.first.length;t++){const e=n.first[t];if(!this.isTerminalSymbol(e[0])){const i=this.getUnterminalSymbolFirst(e,s);n.first.splice(t,1),n.first=this.combineFirst(n.first,i)}}const[i,o]=this.getUnterminalSymbolFollow(n.base,e,s);n.follow=n.follow.concat(i),o.length&&r.push(...o)}r.forEach(t=>{const e=t.base,n=t.target;i.some(t=>t.base===e&&t.target===n)||i.push(t)});for(let t=0;t<i.length;t++){const e=this.getFollowByFirstAndFollow(i[t],s,i);if(!e.length)continue;let n=!1;s.forEach(s=>{if(s.base===i[t].base){const t=[...new Set(s.follow.concat(e))];s.follow.length<t.length&&(n=!0,s.follow=t)}}),n&&(t=-1)}return s}static analysisBySLR1(t){const e=this.initExtentionGrammar(t),n=this.createLivePrefixDFA(e),s=this.createFirstAndFollowBySLR1(t).filter(t=>!t.base.includes("'")),i=new A(t);return i.setExtentionGrammar(e),i.setLivePrefixDFA(n),i.setFirstAndFollow(s),i}};const v=document.getElementById("expression-input");document.getElementById("expression-btn").addEventListener("click",()=>{const t=v.value;if(t)try{const e=w.translate(t),n=S.buildNFA(e),s=S.buildNFAStack(n);C(s);const i=L.buildDFA(s);B(i);const r=L.simplify(i);N(r)}catch(t){alert("输入的表达式有误"),console.log("error :",t)}else alert("请输入一个正规式")});const C=t=>{const e=document.getElementById("nfa-table-header"),n=document.getElementById("nfa-table-main");D(t,e,n,!0)},B=t=>{const e=document.getElementById("dfa-table-header"),n=document.getElementById("dfa-table-main");D(t,e,n)},N=t=>{const e=document.getElementById("min-dfa-table-header"),n=document.getElementById("min-dfa-table-main");D(t,e,n)},D=(t,e,n,s=!1)=>{const i=document.createDocumentFragment(),r=document.createDocumentFragment();a(e,n);const o={};t.forEach(t=>{for(let e in t.transition)o[e]||(o[e]=!0)}),s&&(o["ε"]=!0);const l=document.createElement("th");l.innerText="ID",i.appendChild(l);for(let t in o){const e=document.createElement("th");e.innerText=t,i.appendChild(e)}e.appendChild(i),t.forEach(t=>{const e=document.createElement("tr"),n=document.createElement("td");n.innerText=t.id.toString(),t.isStart&&(n.className+="start "),t.isEnd&&(n.className+="end "),e.appendChild(n);for(let n in o){const i=document.createElement("td");let r=[];s?t.transition[n]?(t.transition[n].forEach(t=>{r.push(t.id)}),i.innerText=r.join("、")):n===p&&t.epsilonTransition.length&&(t.epsilonTransition.forEach(t=>{r.push(t.id)}),i.innerText=r.join("、")):void 0!==t.transition[n]&&(i.innerText=t.transition[n].toString()),e.appendChild(i)}r.appendChild(e)}),n.appendChild(r)},O=document.getElementById("file-cfg"),P=document.getElementById("file-sentence"),k=document.getElementById("input-label-cfg"),M=document.getElementById("input-label-sentence"),R=document.getElementById("input-grammar"),U=document.getElementById("output-grammar-1"),j=document.getElementById("output-grammar-2"),G=document.getElementById("ff-table-header"),_=document.getElementById("ff-table-main");let W;O.addEventListener("change",()=>{const t=O.files;t.length&&(a(R,U,j),H(t[0],k).then(t=>{const e=(t=l(t)).split("\n").filter(t=>t);try{W=I.analysisByLL1(e);const t=W.getWithoutLeftRecursionSymbols(),n=W.getWithoutLeftFactorSymbols(),s=W.getFirstAndFollow(),i=W.getAnalysisTable(),r=W.getIsMatchLL_1();V(e,R),Z(t,U),Z(n,j),z(s,G,_),J(i),$(r)}catch(t){alert("输入文法有误")}}).then(()=>{O.value=""}))}),P.addEventListener("change",()=>{if(!W)return void alert("请先选择文法文件");if(!W.getIsMatchLL_1())return void alert("该文法不符合LL1，请重新选择");const t=P.files;t.length&&H(t[0],M).then(t=>{t=l(t),console.time("本次语法分析所需时间："),W.test(t,"LL1"),console.timeEnd("本次语法分析所需时间：");const e=W.getResult();K(e)}).then(()=>{P.value=""})});const H=(t,e)=>(e.innerText=t.name,new Promise((e,n)=>{const s=new FileReader;s.onload=function(){e(s.result)},s.readAsText(t)})),$=t=>{const e=document.getElementById("isMatchLL1");t?(e.innerText="该语法符合LL(1)",e.classList.remove("error"),e.classList.add("success")):(e.innerText="该语法不符合LL(1)",e.classList.remove("success"),e.classList.add("error"))},V=(t,e)=>{const n=document.createDocumentFragment();t.forEach(t=>{const e=document.createElement("li");e.innerText=t.split(b).join(" "+b+" ").split(d).join(" "+d+" "),n.appendChild(e)}),e.appendChild(n)},z=(t,e,n)=>{a(e,n),e.innerHTML='<td class="table-cell table-cell-first"></td>\n                            <td class="table-cell">First</td>\n                            <td class="table-cell">Follow</td>';const s=document.createDocumentFragment();t.forEach(t=>{const e=document.createElement("tr");e.classList.add("table-row");for(let n in t){const s=document.createElement("td");for(let e of t[n])s.innerText+=` ${e} `;"base"===n&&s.classList.add("table-cell-first"),s.classList.add("table-cell"),e.appendChild(s)}s.appendChild(e)}),n.appendChild(s)},Z=(t,e)=>{const n=q(t);V(n,e)},q=t=>{const e=[];return t.forEach(t=>{let n=t.join(d);const s=n.indexOf(d);n=n.replace(n[s],b),e.push(n)}),e},J=t=>{const e=document.getElementById("analysis-table-header"),n=document.getElementById("analysis-table-main");a(e,n);const s=document.createDocumentFragment(),i=document.createDocumentFragment();t.forEach((t,e)=>{if(0===e){const e=document.createElement("td");e.classList.add("table-cell-first"),e.classList.add("table-cell"),s.appendChild(e);for(let e in t.to){const t=document.createElement("td");t.classList.add("table-cell"),t.innerText=e,s.appendChild(t)}}const n=document.createElement("tr");n.classList.add("table-row");const r=document.createElement("td");r.classList.add("table-cell-first"),r.classList.add("table-cell"),r.innerText=t.base,n.appendChild(r);for(let e in t.to){const s=document.createElement("td");s.classList.add("table-cell"),s.innerText=t.to[e],n.appendChild(s)}i.appendChild(n)}),e.appendChild(s),n.appendChild(i)},K=t=>{const e=document.getElementById("process-table-header"),n=document.getElementById("process-table-main");a(e,n),e.innerHTML='<td class="table-cell">符号栈</td>\n                            <td class="table-cell">当前输入符号</td>\n                            <td class="table-cell">输入串</td>\n                            <td class="table-cell">输入串</td>';const s=document.createDocumentFragment();t.forEach(t=>{const e=document.createElement("tr");e.classList.add("table-row");for(let n in t){const s=document.createElement("td");s.innerText=t[n],s.classList.add("table-cell"),e.appendChild(s)}s.appendChild(e)}),n.appendChild(s)},Q=document.getElementById("file-cfg2"),X=document.getElementById("input-label-cfg2"),Y=document.getElementById("input-grammar-2"),tt=document.getElementById("extention-grammar"),et=document.getElementById("livePrefix-header"),nt=document.getElementById("livePrefix-main"),st=document.getElementById("ff-table-header-2"),it=document.getElementById("ff-table-main-2");Q.addEventListener("change",t=>{const e=Q.files;e.length&&(a(Y,tt),H(e[0],X).then(t=>{const e=(t=l(t)).split("\n").filter(t=>t);try{W=I.analysisBySLR1(e);const t=W.getExtentionGrammar(),n=W.getLivePrefixDFA(),s=W.getFirstAndFollow();V(e,Y),rt(n,et,nt),Z(t,tt),z(s,st,it),console.log("cfg :>> ",W)}catch(t){alert("输入文法有误"),console.log("error :>> ",t)}}).then(()=>{Q.value=""}))});const rt=(t,e,n)=>{a(e,n),e.innerHTML='<td class="table-cell table-cell-first">ID</td>\n                            <td class="table-cell">DFA</td>\n                            <td class="table-cell">备注</td>';const s=document.createDocumentFragment();t.forEach(t=>{const e=document.createElement("tr");e.classList.add("table-row");for(let n in t){const s=document.createElement("td");s.classList.add("table-cell"),"id"===n?(s.classList.add("table-cell-first"),s.innerHTML=`I<span style="font-size: 8px!important">${t[n]}</span>`):"dfa"===n?(s.innerHTML="",t.dfa.forEach(t=>{s.innerHTML+=`${t}<br/>`})):(s.innerHTML="",t.next.forEach(t=>{s.innerHTML+=`通过 <span style="color: red">${t.nextChar}</span> 到达 I<span style="font-size: 8px!important">${t.toId}</span><br/>`})),e.appendChild(s)}s.appendChild(e)}),n.appendChild(s)}}]);